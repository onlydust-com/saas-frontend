import { GithubOrganization, GithubOrganizationInterface } from "@/core/domain/github/models/github-organization-model";
import { components } from "@/core/infrastructure/marketplace-api-client-adapter/__generated/api";

export type GithubOrganizationResponse = {
  organizations: components["schemas"]["GithubOrganizationResponse"][];
};

export interface GithubOrganizationListInterface {
  organizations: GithubOrganizationInterface[];
  getInstalledOrganizations(): GithubOrganizationInterface[];
  getNotInstalledOrganizations(): GithubOrganizationInterface[];
  search(search?: string | null): GithubOrganizationInterface[];
}

export class GithubOrganizationList implements GithubOrganizationListInterface {
  organizations: GithubOrganizationInterface[];

  constructor({ organizations }: GithubOrganizationResponse) {
    this.organizations = organizations.map(organization => new GithubOrganization(organization));
  }

  search(search?: string | null) {
    if (!search) return this.organizations;

    return this.organizations.filter(org => org.name.toLowerCase().includes(search.toLowerCase()));
  }

  getInstalledOrganizations() {
    return this.organizations.filter(organization => organization.isInstalled());
  }

  getNotInstalledOrganizations() {
    return this.organizations.filter(organization => !organization.isInstalled());
  }
}
